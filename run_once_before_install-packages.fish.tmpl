#!/usr/bin/env fish

echo "Starting setup on macOS"

# Check if Homebrew is already installed
if not command -v brew >/dev/null
    echo "Installing Homebrew..."
    /bin/bash -c "(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
else
    echo "Homebrew already installed, skipping installation"
end

# Install packages from Brewfile
echo "Installing packages from Brewfile..."
brew bundle --file="{{ .chezmoi.sourceDir }}/Brewfile" --verbose

# Install CLI tools from Cargofile
echo "Installing CLI tools from Cargofile..."
set -l cargofile "{{ .chezmoi.sourceDir }}/Cargofile"
if test -f $cargofile
    cat $cargofile | grep -v '^#' | grep -v '^$' | xargs -n1 cargo install
end

echo "Setup complete"
